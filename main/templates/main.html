{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>Main Page</title>

<!-- Bootstrap icon--> 
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700">

<style>
    .ReviewButton {
        background-color: #0d6efd;
        color: white;
        padding: 10px 20px;
        cursor: pointer;
        transition: background-color 0.3s;
        outline: none;
        border: solid ;
    }
    .card {
        font-family: 'Roboto', sans-serif; /* Ganti 'Roboto' dengan nama font yang Anda inginkan */
        transition: transform 0.2s;
    }
    
    .card:hover {
        transform: scale(1.05);
        filter: brightness(0.9);
    }
</style>
{% endblock meta %}

{% block content %}
    <body>
        <div class="d-flex grid gap-4 flex-wrap m-4" id="product_cards">
    <div class="container">
        <nav class="navbar navbar-expand-lg py-1" style="background-color: #e3f2fd;">
            <div class="container">
                <a class="navbar-brand" >Welcome back, {{ name }}</a>
                <button
                    class="navbar-toggler"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target=""
                    >
                    <span class="navbar-toggler-icon"></span>
                </button>
    
                <div class="collapse navbar-collapse" id="navmenu">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'profile' %}" >
                                Profile
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" >
                                About
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'logout' %}">
                                Logout
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'review:show_reviews_specific_user' %}">
                                Edit Review
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>


        <div class="d-flex grid gap-4 flex-wrap m-4" id="books_catalog"></div>
            
        
    </div>

    <script>

        async function getBooks() {
            return fetch("{% url 'book:get_books' %}").then((res) => res.json())
        }
    
        async function refreshCatalog() {
            let htmlString = ''
            document.getElementById("books_catalog").innerHTML = ""
            const books = await getBooks()
            books.forEach((book) => {
                const bookId = book.id;

                htmlString +=`   
                <div class="card mb-4" data-book-pk="${ book.pk }" style="width: 19rem;">
                    <div class="card-body">
                        <h5 class="card-title"><strong>${ book.fields.name } (${ book.fields.year }s)</strong></h5>
                        <h6 class="card-subtitle mb-2 text-muted">${ book.fields.author }</h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">Genre: ${ book.fields.genre }</li>
                            <li class="list-group-item">Rating: ${ book.fields.rating }</li>
                        </ul>
                    </div>
                    <div class="card-footer">
                        <button class="rounded review-button ReviewButton mx-auto" data-book-pk="${ book.pk }">
                            <i class="bi bi-pencil" style="color: white;"></i> Review
                        </button>
                    </div>
                </div>`
            });
            document.getElementById("books_catalog").innerHTML += htmlString;

            document.querySelectorAll(".review-button").forEach((button) => {
                button.addEventListener("click", function (event) {
                    event.stopPropagation();
                    const bookPk = this.getAttribute("data-book-pk");
                    const url = `/review/show-reviews/${bookPk}/`; 
                    window.location.href = url;
                });
            });
            document.querySelectorAll(".card").forEach((card) => {
                card.addEventListener("click", function () {
                    const bookPk = this.getAttribute("data-book-pk");
                    const url = `/edit_book/show/${bookPk}/`; 
                    window.location.href = url;
                });
            });
        }
        refreshCatalog()

    </script>
    
{% endblock content %}